# AWS S3 Vectors MCP Server

> ## ⚠️ IMPORTANT: YOU ARE RESPONSIBLE FOR YOUR AGENTS
>
> You are solely responsible for the actions and permissions of agents using the MCP server.
>
> - Always follow the **principle of least privilege**—grant only the permissions necessary for the agent to function.
> - Ensure your AWS credentials have appropriate permissions for Amazon Bedrock and S3 Vectors operations.
> - **We recommend you validate any instructions generated by your LLM before execution**.
> - With AWS S3 Vectors MCP Server, we recommend exercising caution when integrating it into automated workflows.
>
> Misconfigured permissions or unverified agent actions may result in **unexpected costs, failed operations, or unexpected LLM behavior**.

An AWS Labs Model Context Protocol (MCP) server for AWS S3 Vectors that enables AI assistants to embed text using Amazon Bedrock models and store/query vector embeddings in S3 Vectors indexes.

## Overview

The S3 Vectors MCP Server simplifies vector operations by providing capabilities to embed text using Amazon Bedrock models, store embeddings in S3 Vectors indexes with metadata, and perform similarity searches with advanced filtering. This allows for streamlined vector operations and easier integration with AI applications requiring semantic search capabilities.

## Features

- **Vector Embedding**: Convert text to vector embeddings using Amazon Bedrock models
- **Vector Storage**: Store embeddings in AWS S3 Vectors indexes with optional metadata
- **Similarity Search**: Query for similar vectors with advanced filtering capabilities
- **Multiple Transport Support**: Support for stdio, Server-Sent Events (SSE), and StreamableHTTP
- **Flexible Configuration**: Environment variable-based configuration for easy deployment

## Prerequisites

1. Install `uv` from [Astral](https://docs.astral.sh/uv/getting-started/installation/) or the [GitHub README](https://github.com/astral-sh/uv#installation)
2. Install Python using `uv python install 3.11`
3. Set up AWS credentials with access to Amazon Bedrock and S3 Vectors
4. An existing S3 Vectors bucket and index

## Setup

### Installation

| Cursor | VS Code |
|:------:|:-------:|
| [![Install MCP Server](https://cursor.com/deeplink/mcp-install-light.svg)](https://cursor.com/install-mcp?name=awslabs.s3-vectors-mcp-server&config=eyJjb21tYW5kIjoidXZ4IGF3c2xhYnMuczMtdmVjdG9ycy1tY3Atc2VydmVyQGxhdGVzdCIsImVudiI6eyJTM1ZFQ1RPUlNfQlVDS0VUX05BTUUiOiJ5b3VyLXZlY3RvcnMtYnVja2V0IiwiUzNWRUNUT1JTX0lOREVYX05BTUUiOiJ5b3VyLWluZGV4IiwiUzNWRUNUT1JTX01PREVMX0lEIjoiYW1hem9uLnRpdGFuLWVtYmVkLXRleHQtdjI6MCIsIkFXU19SRUdJT04iOiJ1cy1lYXN0LTEifX0%3D) | [![Install on VS Code](https://img.shields.io/badge/Install_on-VS_Code-FF9900?style=flat-square&logo=visualstudiocode&logoColor=white)](https://insiders.vscode.dev/redirect/mcp/install?name=S3%20Vectors%20MCP%20Server&config=%7B%22command%22%3A%22uvx%22%2C%22args%22%3A%5B%22awslabs.s3-vectors-mcp-server%40latest%22%5D%2C%22env%22%3A%7B%22S3VECTORS_BUCKET_NAME%22%3A%22your-vectors-bucket%22%2C%22S3VECTORS_INDEX_NAME%22%3A%22your-index%22%2C%22S3VECTORS_MODEL_ID%22%3A%22amazon.titan-embed-text-v2%3A0%22%2C%22AWS_REGION%22%3A%22us-east-1%22%7D%7D) |

Configure the MCP server in your MCP client configuration (e.g., for Amazon Q Developer CLI, edit `~/.aws/amazonq/mcp.json`):

```json
{
  "mcpServers": {
    "awslabs.s3-vectors-mcp-server": {
      "command": "uvx",
      "args": ["awslabs.s3-vectors-mcp-server@latest"],
      "env": {
        "S3VECTORS_BUCKET_NAME": "your-vectors-bucket",
        "S3VECTORS_INDEX_NAME": "your-index",
        "S3VECTORS_MODEL_ID": "amazon.titan-embed-text-v2:0",
        "AWS_REGION": "us-east-1"
      }
    }
  }
}
```

## Server Configuration Options

The AWS S3 Vectors MCP Server supports several environment variables for configuration:

| Variable | Required | Description | Example |
|----------|----------|-------------|---------|
| `S3VECTORS_BUCKET_NAME` | Yes | S3 bucket name for vector storage | `my-vectors-bucket` |
| `S3VECTORS_INDEX_NAME` | Yes | Vector index name | `my-index` |
| `S3VECTORS_MODEL_ID` | Yes | Bedrock embedding model ID | `amazon.titan-embed-text-v2:0` |
| `S3VECTORS_DIMENSIONS` | No | Embedding dimensions | `1024` |
| `S3VECTORS_REGION` | No | AWS region | `us-east-1` |
| `S3VECTORS_PROFILE` | No | AWS profile name | `default` |

### `--log-dir`

Specifies the directory where the server writes its log files. If not provided, the default log directory depends on the operating system:

- **macOS**: `~/Library/Logs`
- **Windows**: `~/AppData/Local/Logs`
- **Linux/Other**: `~/.local/share/s3-vectors-mcp-server/logs/`

Example:
```json
{
  "mcpServers": {
    "awslabs.s3-vectors-mcp-server": {
      "command": "uvx",
      "args": [
        "awslabs.s3-vectors-mcp-server@latest",
        "--log-dir",
        "/tmp/s3-vectors-logs"
      ],
      "env": {
        "S3VECTORS_BUCKET_NAME": "your-vectors-bucket",
        "S3VECTORS_INDEX_NAME": "your-index",
        "S3VECTORS_MODEL_ID": "amazon.titan-embed-text-v2:0"
      }
    }
  }
}
```

## Usage Examples

| Prompt | Description |
|--------|-------------|
| `Embed and store this text: "Machine learning is transforming industries"` | Converts text to vector embeddings using Bedrock models and stores in S3 Vectors with auto-generated ID |
| `Find similar vectors to "artificial intelligence applications" with top 5 results` | Performs similarity search to find the most relevant vectors based on query text |
| `Store vector with metadata: category=tech, version=1.0` | Embeds text and stores with custom metadata for better organization and filtering |
| `Query vectors with filter: category equals "documentation"` | Searches for similar vectors while applying metadata filters to narrow results |
| `Embed text with custom vector ID "doc-001"` | Stores vector embedding with a specific identifier for easy retrieval |

## Supported Embedding Models

This server works with Amazon Bedrock embedding models, including:

- `amazon.titan-embed-text-v1`
- `amazon.titan-embed-text-v2:0`
- `amazon.titan-embed-image-v1`
- `cohere.embed-english-v3`
- `cohere.embed-multilingual-v3`

## Filter Expressions

The server supports AWS S3 Vectors API operators for metadata filtering:

**Comparison Operators**: `$eq`, `$ne`, `$gt`, `$gte`, `$lt`, `$lte`, `$in`, `$nin`
**Logical Operators**: `$and`, `$or`, `$not`

Example filters:
```json
{"category": {"$eq": "documentation"}}
{"$and": [{"category": "tech"}, {"version": {"$gte": "2.0"}}]}
```

## Security Considerations

When using this MCP server, consider:

- The MCP server needs permissions for Amazon Bedrock (`bedrock:InvokeModel`) and S3 Vectors operations
- Follow the principle of least privilege when setting up IAM permissions
- Use separate AWS profiles for different environments (dev, test, prod)
- Monitor embedding costs as Bedrock models incur charges per token

## Troubleshooting

- If you encounter permission errors, verify your IAM user has access to Bedrock models and S3 Vectors
- For Bedrock access issues, ensure the model is available in your region
- For S3 Vectors issues, verify your bucket and index exist and are properly configured
